<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>画像拡張子変更</title>
</head>
<body>
    <h2>JPEG形式の画像を選択してください (.jpeg, .jpg, .jpe, .jfif, .jfi, .jif)</h2>
    <input type="file" id="imageInput" accept=".jpeg, .jpg, .jpe, .jfif, .jfi, .jif" />
    
    <label for="extensionSelect">変換後の拡張子を選択:</label>
    <select id="extensionSelect">
        <option value="jpeg">.jpeg</option>
        <option value="jpg">.jpg</option>
        <option value="jpe">.jpe</option>
        <option value="jfif">.jfif</option>
        <option value="jfi">.jfi</option>
        <option value="jif">.jif</option>
    </select>
    
    <button id="convertButton" disabled>画像を変換してダウンロード</button>
    <div id="previewContainer">
        <h3>画像プレビュー</h3>
        <img id="imagePreview" src="" alt="画像がここに表示されます" style="max-width: 100%; height: auto; display: none;" />
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const convertButton = document.getElementById('convertButton');
        const imagePreview = document.getElementById('imagePreview');
        const extensionSelect = document.getElementById('extensionSelect');

        let fileDataURL = '';  // 画像データを保持する変数

        imageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const fileExtension = file.name.split('.').pop().toLowerCase();
                const allowedExtensions = ['jpeg', 'jpg', 'jpe', 'jfif', 'jfi', 'jif'];

                if (allowedExtensions.includes(fileExtension)) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        fileDataURL = e.target.result; // ファイルのデータURLを保持
                        imagePreview.src = fileDataURL;
                        imagePreview.style.display = 'block';
                        convertButton.disabled = false;
                    }
                    
                    reader.readAsDataURL(file);
                } else {
                    alert('対応している画像形式は .jpeg, .jpg, .jpe, .jfif, .jfi, .jif のみです。');
                    imagePreview.style.display = 'none';
                    convertButton.disabled = true;
                }
            }
        });

        convertButton.addEventListener('click', function() {
            const selectedExtension = extensionSelect.value; // 選択された拡張子を取得
            const link = document.createElement('a');
            link.href = fileDataURL; // 保持しているデータURLをリンクに設定
            link.download = `converted-image.${selectedExtension}`; // 選択された拡張子でダウンロード
            link.click();
        });
    </script>
</body>
</html>